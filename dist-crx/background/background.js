"use strict";const p=/\/\/(www\.)?([^/]+)/;let d=[],c={},a=[],s=[];const f=async()=>{c={},a=[],d=await chrome.tabs.query({currentWindow:!0}),d.forEach(o=>{if(o.url){const t=o.url.match(p);t&&a.push(t[0])}}),a=Array.from(new Set(a));for(const o of d)if(o.url){const t=o.url.match(p);if(t){const e=t==null?void 0:t[0];e&&a.includes(e)&&(c[e]?c[e].push(o):c[e]=[o])}}s=[];for(const o of Object.entries(c)){const t=o[0],e=o[1];e.length>1&&s.push({url:t,groupId:-2,children:e})}console.log("当前窗口所有标签页：",d),console.log("存在同域名可生成分组：",s)};f();const w=async()=>{if(await f(),s&&s.length>0)for(const o of s){const t=o.children.map(({id:r})=>r),e=await chrome.tabs.group({tabIds:t});o.groupId=e;const n=h(o.url);await chrome.tabGroups.update(e,{title:n})}else console.log("当前不存在相同域名的标签页")};let g=null;chrome.tabs.onActivated.addListener(function(o){const t=o.tabId;chrome.tabs.get(t,function(e){console.log("当前选项卡信息:",e),g=e})});chrome.tabs.onCreated.addListener(function(o){chrome.storage.sync.get(["isAuto"],async function(t){if(!t.isAuto)return;const e=o.id;chrome.tabs.get(e,function(n){I(n)})})});chrome.runtime.onMessage.addListener(async o=>{console.log(o,g);const{action:t}=o;if(t=="autoGroup"&&await w(),!g)return;const e=g.groupId;if(e!=-1){const r=(await chrome.tabs.query({groupId:e})).map(i=>i.id);switch(t){case"cancelGroup":await chrome.tabs.ungroup(r);break;case"closeGroup":await chrome.tabs.remove(r);break}}else console.log("当前页面没有分组")});const h=o=>{if(!o)return"";const t=o.match(p);return t&&t.length>2?t[2]:(console.log("无法匹配域名"),"")},I=async o=>{if(o.pendingUrl){let t=o.pendingUrl.match(p);const e=t==null?void 0:t[0];if(console.log("新打开标签域名：",e),!e)return;const n=s.find(r=>r.url==e);if(n&&n.groupId!=-2)chrome.tabs.group({tabIds:o.id,groupId:n.groupId});else{await f();const r=await chrome.tabs.query({currentWindow:!0,groupId:-1});console.log("未分组选项卡：",r);const i=r.filter(u=>{var l;return((l=u.url)==null?void 0:l.indexOf(e))!=-1});if(i){const u=i.map(b=>b.id);if(u.length==0)return;const l=await chrome.tabs.group({tabIds:[...u,o.id]}),m=h(o.pendingUrl);await chrome.tabGroups.update(l,{title:m})}}}else console.warn("新打开选项卡pendingUrl：",o.pendingUrl)};
