"use strict";const I="test";console.log("background.index.ts",I);const p=new RegExp("https://(.*?)/");let l=[],a={},c=[],r=[];const f=async()=>{a={},c=[],l=await chrome.tabs.query({currentWindow:!0}),l.forEach(o=>{if(o.url){const e=o.url.match(p);e&&c.push(e[0])}}),c=Array.from(new Set(c));for(const o of l)if(o.url){const e=o.url.match(p);if(e){const t=e==null?void 0:e[0];t&&c.includes(t)&&(a[t]?a[t].push(o):a[t]=[o])}}r=[];for(const o of Object.entries(a)){const e=o[0],t=o[1];t.length>1&&r.push({url:e,groupId:-2,children:t})}console.log("当前窗口所有标签页：",l),console.log("存在同域名可生成分组：",r)};f();const y=async()=>{if(await f(),r&&r.length>0)for(const o of r){const e=o.children.map(({id:s})=>s),t=await chrome.tabs.group({tabIds:e});o.groupId=t;const n=h(o.url);await chrome.tabGroups.update(t,{title:n})}else console.log("当前不存在相同域名的标签页")};let d=null;chrome.tabs.onActivated.addListener(function(o){const e=o.tabId;chrome.tabs.get(e,function(t){console.log("当前选项卡信息:",t),d=t})});chrome.tabs.onCreated.addListener(function(o){chrome.storage.sync.get(["isAuto"],async function(e){if(e.isAuto&&o.pendingUrl){let t=o.pendingUrl.match(p);const n=t==null?void 0:t[0];if(!n)return;const s=r.find(i=>i.url==n);if(s&&s.groupId!=-2)chrome.tabs.group({tabIds:o.id,groupId:s.groupId});else{await f();const m=(await chrome.tabs.query({currentWindow:!0,groupId:-1})).filter(g=>{var u;return((u=g.url)==null?void 0:u.indexOf(n))!=-1});if(m){const g=m.map(w=>w.id),u=await chrome.tabs.group({tabIds:[...g,o.id]}),b=h(o.pendingUrl);await chrome.tabGroups.update(u,{title:b})}}}})});chrome.runtime.onMessage.addListener(async o=>{console.log(o,d);const{action:e}=o;if(e=="autoGroup"&&await y(),!d)return;const t=d.groupId;if(t!=-1){const s=(await chrome.tabs.query({groupId:t})).map(i=>i.id);switch(e){case"cancelGroup":await chrome.tabs.ungroup(s);break;case"closeGroup":await chrome.tabs.remove(s);break}}else console.log("当前页面没有分组")});const h=o=>{if(!o)return"";const e=o.match(/^(https?:\/\/)?([^/]+)\//);if(e){const n=e[2].split(".");if(n.length>=2)return n[0];console.log("无法提取子域名")}else console.log("无法提取域名");return""};
